# asus_nvram_editing
Edit country code (or other NVRAM defaults) on Asus routers

First of all, ssh to the router.

Device /dev/mtd10 is a UBIFS file system that contains only the file nvram.nvm, which contains the default NVRAM values. To access the UBIFS filesystem we must first attach it to the system using the ubiattach command.

    # ubiattach -p /dev/mtd10

A successful attach will give you a message such as this:

    UBI device number 5, total 64 LEBs (8126464 bytes, 7.7 MiB), available 0 LEBs (0 bytes), LEB size 126976 bytes (124.0 KiB)

Next we must create a mount point and mount the UBIFS file system. Note the "5" in ubi5_0 is taken from the device number given in the success message above. Yours may differ, so for example if it says "UBI device number 2" you will be using "ubi2_0" below.

    # mkdir ./mountpoint
    # mount -t ubifs ubi5_0 ./mountpoint

Once the correct file system has been mounted, copy nvram.nvm from /mountpoint to your home folder. Change your country code to something else (in my case, I'm changing CA/01 to US/01) with the following command, substituting as required:

    # sed 's/territory_code=CA\/01/territory_code=US\/01/g' nvram.nvm > nvram.new

You can view the modified file with cat or more to ensure the changes were made. The contents will appear as a continuous stream of text as it uses null characters as line delimiters. The territory code text will be near the end.

Rename the original nvram.nvm as a backup and rename nvram.new as nvram.nvm. Put this new nvram.nvm back where the original file was under ./mountpoint. Unmount the file system at ./mountpoint. You should back up the original nvram.nvm file somewhere. I used the ftpput command to copy it to the FTP server on my LAN, but there may be other ways to make a copy of it, say to an attached USB drive.
    
    # umount -l ./mountpoint
    or
    # umount -f ./mountpoint

Finally, reset the router to factory defaults from the web interface in order to have the values associated with the new country code take effect. It appears that many NVRAM values, like the list of available channels, are generated by the router firmware depending on the country code specified in the NVRAM file. After this procedure DFS channels were available that were not available under the CA/01 country code.
